<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NetCard Architect Ultra | Professional Suite</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;700;900&family=JetBrains+Mono&family=Playfair+Display:wght@700&family=Bebas+Neue&display=swap" rel="stylesheet">
    <style>
        html, body {
            width: 100%;
            height: 100vh;
            overflow: hidden;
            background-color: #050505;
            font-family: 'Inter', sans-serif;
            color: #f1f5f9;
        }

        .glass-panel {
            background: rgba(15, 15, 15, 0.9);
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(255, 255, 255, 0.08);
        }

        .control-label {
            font-size: 10px;
            font-weight: 900;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            margin-bottom: 0.75rem;
            display: block;
        }

        input[type="range"] { 
            accent-color: #3b82f6; 
            height: 4px;
            appearance: none;
            background: rgba(255,255,255,0.1);
            border-radius: 2px;
        }

        .draggable {
            cursor: move;
            user-select: none;
        }
        
        .draggable:hover {
            outline: 2px dashed #3b82f6;
            outline-offset: 4px;
        }

        .selected-element {
            outline: 2px solid #3b82f6 !important;
            outline-offset: 4px;
        }

        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }

        .btn-active { background-color: #2563eb !important; color: white !important; }
        .btn-inactive { background-color: rgba(255,255,255,0.05); color: #94a3b8; }
        
        #main-svg {
            filter: drop-shadow(0 25px 50px rgba(0,0,0,0.8));
            background-size: 30px 30px;
        }
    </style>
</head>
<body class="flex flex-col">

    <nav class="h-14 bg-black border-b border-white/5 flex items-center justify-between px-6 shrink-0 z-50">
        <div class="flex items-center gap-4">
            <div class="w-8 h-8 bg-blue-600 rounded flex items-center justify-center">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3"><rect width="20" height="14" x="2" y="5" rx="2"/><line x1="2" x2="22" y1="10" y2="10"/></svg>
            </div>
            <h1 class="font-black text-lg tracking-tighter uppercase">NetCard <span class="text-blue-500">FreeEdit</span></h1>
        </div>

        <div class="flex items-center gap-4">
            <button onclick="addTextBox()" class="text-[10px] font-bold border border-white/20 px-3 py-2 rounded hover:bg-white/5 transition-all">
                + ADD TEXT BOX
            </button>
            <button id="exportBtn" class="bg-blue-600 hover:bg-blue-500 text-white px-5 py-2 rounded font-bold text-xs flex items-center gap-2 transition-all shadow-lg shadow-blue-600/20">
                EXPORT PNG
            </button>
        </div>
    </nav>

    <div class="flex flex-1 overflow-hidden">
        <!-- Sidebar -->
        <aside class="w-80 glass-panel overflow-y-auto p-6 shrink-0 custom-scrollbar">
            <div class="space-y-8 pb-12">
                
                <section>
                    <span class="control-label">Layout Configuration</span>
                    <div class="grid grid-cols-2 gap-2 mb-4">
                        <button onclick="setOrient('H')" id="btn-H" class="p-2 rounded text-[10px] font-bold transition-colors btn-active">HORIZONTAL</button>
                        <button onclick="setOrient('V')" id="btn-V" class="p-2 rounded text-[10px] font-bold transition-colors btn-inactive">VERTICAL</button>
                    </div>
                </section>

                <section id="elementEditor" class="hidden">
                    <span class="control-label">Element Properties</span>
                    <div class="bg-white/5 p-4 rounded border border-white/10 space-y-4">
                        <div>
                            <label class="text-[9px] text-gray-500 block mb-1">FONT STYLE</label>
                            <select id="fontSelect" onchange="updateSelectedElement('fontFamily', this.value)" class="w-full bg-black border border-white/10 rounded p-2 text-xs text-white">
                                <option value="Inter">Modern (Sans)</option>
                                <option value="'Playfair Display'">Executive (Serif)</option>
                                <option value="'JetBrains Mono'">Cyber (Mono)</option>
                                <option value="'Bebas Neue'">Bauhaus (Bold)</option>
                            </select>
                        </div>
                        <div id="textInputContainer">
                            <label class="text-[9px] text-gray-500 block mb-1">CONTENT</label>
                            <input type="text" id="contentInput" oninput="updateSelectedElement('text', this.value)" class="w-full bg-black border border-white/10 rounded p-2 text-xs text-white">
                        </div>
                        <div>
                            <label class="text-[9px] text-gray-500 block mb-1">SIZE</label>
                            <input type="range" id="sizeInput" min="8" max="200" oninput="updateSelectedElement('fontSize', this.value)" class="w-full">
                        </div>
                        <div>
                            <label class="text-[9px] text-gray-500 block mb-1">COLOR</label>
                            <input type="color" id="colorInput" oninput="updateSelectedElement('fill', this.value)" class="w-full h-8 bg-transparent">
                        </div>
                        <button onclick="deleteSelected()" id="deleteBtn" class="w-full py-2 bg-red-900/20 text-red-500 text-[10px] font-bold rounded hover:bg-red-500 hover:text-white transition-all">DELETE ELEMENT</button>
                    </div>
                </section>

                <section>
                    <span class="control-label">Global Styles</span>
                    <div class="space-y-4">
                        <div class="flex justify-between items-center">
                            <span class="text-xs text-gray-400">Background</span>
                            <input type="color" id="col-bg" value="#0a0a0a" oninput="render()" class="h-6 w-12 bg-transparent">
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-xs text-gray-400">Card Accent</span>
                            <input type="color" id="col-prime" value="#3b82f6" oninput="render()" class="h-6 w-12 bg-transparent">
                        </div>
                    </div>
                </section>

                <section>
                    <span class="control-label">Identity Assets</span>
                    <label class="block w-full bg-white/5 border-2 border-dashed border-white/10 rounded p-4 text-center cursor-pointer hover:border-blue-500/50 transition-all">
                        <span class="text-[9px] font-bold text-gray-500">UPLOAD LOGO/IMAGE</span>
                        <input type="file" id="assetInput" onchange="handleFile(this)" class="hidden" accept="image/*">
                    </label>
                </section>
            </div>
        </aside>

        <!-- Canvas Area -->
        <main class="flex-1 bg-[#020202] relative flex items-center justify-center p-8 overflow-hidden">
            <div id="canvasWrapper" class="relative w-full max-w-[850px] aspect-[1050/600] transition-all">
                <svg id="main-svg" viewBox="0 0 1050 600" class="w-full h-full rounded shadow-2xl bg-black">
                    <!-- Dynamic Content -->
                </svg>
            </div>
            
            <!-- Context Info -->
            <div class="absolute bottom-6 right-6 text-[10px] text-gray-600 font-mono pointer-events-none">
                CLICK TO SELECT • DRAG TO MOVE • USE SIDEBAR TO STYLE
            </div>
        </main>
    </div>

    <canvas id="exportCanvas" class="hidden"></canvas>

    <script>
        // --- State Management ---
        const state = {
            orientation: 'H',
            bg: '#0a0a0a',
            prime: '#3b82f6',
            elements: [
                { id: 'el-name', type: 'text', text: 'ALEXANDER VANCE', x: 80, y: 400, fontSize: 64, fill: '#ffffff', fontFamily: 'Inter', fontWeight: '900' },
                { id: 'el-role', type: 'text', text: 'CREATIVE DIRECTOR', x: 80, y: 450, fontSize: 20, fill: '#3b82f6', fontFamily: 'Inter', fontWeight: '700' },
                { id: 'el-qr', type: 'image', href: '', x: 850, y: 400, width: 120, height: 120 },
                { id: 'el-circle', type: 'circle', cx: 800, cy: 150, r: 100, fill: '#3b82f6', opacity: 0.1 }
            ],
            selectedId: null,
            isDragging: false,
            dragTarget: null,
            dragOffset: { x: 0, y: 0 }
        };

        const svg = document.getElementById('main-svg');
        const elementEditor = document.getElementById('elementEditor');

        // --- Core Functions ---

        async function init() {
            const qrUrl = await generateQR("https://google.com");
            const qrEl = state.elements.find(e => e.id === 'el-qr');
            if (qrEl) qrEl.href = qrUrl;
            render();
            setupInteractions();
        }

        function setOrient(o) {
            state.orientation = o;
            const wrapper = document.getElementById('canvasWrapper');
            document.getElementById('btn-H').className = o === 'H' ? 'p-2 rounded text-[10px] font-bold transition-colors btn-active' : 'p-2 rounded text-[10px] font-bold transition-colors btn-inactive';
            document.getElementById('btn-V').className = o === 'V' ? 'p-2 rounded text-[10px] font-bold transition-colors btn-active' : 'p-2 rounded text-[10px] font-bold transition-colors btn-inactive';

            if(o === 'H') {
                wrapper.className = "relative w-full max-w-[850px] aspect-[1050/600]";
                svg.setAttribute('viewBox', '0 0 1050 600');
            } else {
                wrapper.className = "relative h-full max-h-[850px] aspect-[600/1050]";
                svg.setAttribute('viewBox', '0 0 600 1050');
            }
            render();
        }

        async function generateQR(data) {
            const color = state.prime.replace('#', '');
            const bg = state.bg.replace('#', '');
            const url = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${encodeURIComponent(data)}&color=${color}&bgcolor=${bg}`;
            try {
                const response = await fetch(url);
                const blob = await response.blob();
                return new Promise(resolve => {
                    const reader = new FileReader();
                    reader.onloadend = () => resolve(reader.result);
                    reader.readAsDataURL(blob);
                });
            } catch { return url; }
        }

        function handleFile(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = e => {
                    const newAsset = {
                        id: 'asset-' + Date.now(),
                        type: 'image',
                        href: e.target.result,
                        x: 100,
                        y: 100,
                        width: 200,
                        height: 200
                    };
                    state.elements.push(newAsset);
                    render();
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        function addTextBox() {
            const newText = {
                id: 'text-' + Date.now(),
                type: 'text',
                text: 'New Text Box',
                x: 300,
                y: 300,
                fontSize: 24,
                fill: '#ffffff',
                fontFamily: 'Inter',
                fontWeight: '400'
            };
            state.elements.push(newText);
            selectElement(newText.id);
            render();
        }

        // --- Interaction Logic ---

        function setupInteractions() {
            svg.addEventListener('mousedown', startDrag);
            window.addEventListener('mousemove', drag);
            window.addEventListener('mouseup', endDrag);

            // Touch support
            svg.addEventListener('touchstart', (e) => startDrag(e.touches[0]));
            window.addEventListener('touchmove', (e) => drag(e.touches[0]));
            window.addEventListener('touchend', endDrag);
        }

        function getSVGCoords(e) {
            const CTM = svg.getScreenCTM();
            return {
                x: (e.clientX - CTM.e) / CTM.a,
                y: (e.clientY - CTM.f) / CTM.d
            };
        }

        function startDrag(e) {
            const target = e.target.closest('.draggable');
            if (!target) {
                state.selectedId = null;
                elementEditor.classList.add('hidden');
                render();
                return;
            }

            const id = target.getAttribute('data-id');
            selectElement(id);

            state.isDragging = true;
            state.dragTarget = state.elements.find(el => el.id === id);
            
            const coords = getSVGCoords(e);
            if (state.dragTarget.type === 'circle') {
                state.dragOffset.x = coords.x - state.dragTarget.cx;
                state.dragOffset.y = coords.y - state.dragTarget.cy;
            } else {
                state.dragOffset.x = coords.x - state.dragTarget.x;
                state.dragOffset.y = coords.y - state.dragTarget.y;
            }
        }

        function drag(e) {
            if (!state.isDragging || !state.dragTarget) return;
            const coords = getSVGCoords(e);

            if (state.dragTarget.type === 'circle') {
                state.dragTarget.cx = coords.x - state.dragOffset.x;
                state.dragTarget.cy = coords.y - state.dragOffset.y;
            } else {
                state.dragTarget.x = coords.x - state.dragOffset.x;
                state.dragTarget.y = coords.y - state.dragOffset.y;
            }
            render();
        }

        function endDrag() {
            state.isDragging = false;
        }

        function selectElement(id) {
            state.selectedId = id;
            const el = state.elements.find(e => e.id === id);
            
            elementEditor.classList.remove('hidden');
            document.getElementById('fontSelect').value = el.fontFamily || 'Inter';
            document.getElementById('sizeInput').value = el.fontSize || el.width || el.r || 50;
            document.getElementById('colorInput').value = el.fill || '#ffffff';
            
            const textContainer = document.getElementById('textInputContainer');
            if (el.type === 'text') {
                textContainer.classList.remove('hidden');
                document.getElementById('contentInput').value = el.text;
            } else {
                textContainer.classList.add('hidden');
            }
            render();
        }

        function updateSelectedElement(prop, value) {
            if (!state.selectedId) return;
            const el = state.elements.find(e => e.id === state.selectedId);
            
            if (prop === 'fontSize') {
                if (el.type === 'text') el.fontSize = parseInt(value);
                if (el.type === 'image') { el.width = parseInt(value); el.height = parseInt(value); }
                if (el.type === 'circle') el.r = parseInt(value);
            } else {
                el[prop] = value;
            }
            render();
        }

        function deleteSelected() {
            if (!state.selectedId) return;
            state.elements = state.elements.filter(e => e.id !== state.selectedId);
            state.selectedId = null;
            elementEditor.classList.add('hidden');
            render();
        }

        // --- Rendering Engine ---

        function render() {
            const bg = document.getElementById('col-bg').value;
            const prime = document.getElementById('col-prime').value;
            state.bg = bg;
            state.prime = prime;

            let html = `
                <defs>
                    <pattern id="grid" width="30" height="30" patternUnits="userSpaceOnUse">
                        <path d="M 30 0 L 0 0 0 30" fill="none" stroke="${prime}" stroke-width="0.3" opacity="0.2" />
                    </pattern>
                </defs>
                <rect width="100%" height="100%" fill="${bg}" />
                <rect width="100%" height="100%" fill="url(#grid)" />
            `;

            state.elements.forEach(el => {
                const isSelected = el.id === state.selectedId;
                const classes = `draggable ${isSelected ? 'selected-element' : ''}`;
                
                if (el.type === 'text') {
                    html += `<text 
                        data-id="${el.id}"
                        x="${el.x}" y="${el.y}" 
                        fill="${el.fill}" 
                        font-family="${el.fontFamily}" 
                        font-size="${el.fontSize}" 
                        font-weight="${el.fontWeight}" 
                        class="${classes}">${el.text}</text>`;
                } else if (el.type === 'image') {
                    html += `<image 
                        data-id="${el.id}"
                        href="${el.href}" 
                        x="${el.x}" y="${el.y}" 
                        width="${el.width}" height="${el.height}" 
                        class="${classes}" />`;
                } else if (el.type === 'circle') {
                    html += `<circle 
                        data-id="${el.id}"
                        cx="${el.cx}" cy="${el.cy}" r="${el.r}" 
                        fill="${el.fill}" opacity="${el.opacity}" 
                        class="${classes}" />`;
                }
            });

            svg.innerHTML = html;
        }

        // --- Export ---

        document.getElementById('exportBtn').addEventListener('click', async () => {
            const canvas = document.getElementById('exportCanvas');
            const ctx = canvas.getContext('2d');
            const isH = state.orientation === 'H';
            const baseW = isH ? 1050 : 600;
            const baseH = isH ? 600 : 1050;
            const scale = 2; 

            canvas.width = baseW * scale;
            canvas.height = baseH * scale;

            // Deselect before export
            const currentSelected = state.selectedId;
            state.selectedId = null;
            render();

            const serializer = new XMLSerializer();
            const svgStr = serializer.serializeToString(svg);
            const img = new Image();
            const svgBlob = new Blob([svgStr], {type: 'image/svg+xml;charset=utf-8'});
            const url = URL.createObjectURL(svgBlob);

            img.onload = () => {
                ctx.fillStyle = state.bg;
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                const link = document.createElement('a');
                link.download = `NETCARD_DESIGN_${Date.now()}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
                URL.revokeObjectURL(url);
                // Restore selection
                state.selectedId = currentSelected;
                render();
            };
            img.src = url;
        });

        init();
    </script>
</body>
</html>

