<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PixelPerfect Photo Editor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a;
            color: #f8fafc;
        }

        .slider-custom {
            -webkit-appearance: none;
            width: 100%;
            height: 4px;
            background: #334155;
            border-radius: 5px;
            outline: none;
        }

        .slider-custom::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            background: #38bdf8;
            cursor: pointer;
            border-radius: 50%;
            border: 2px solid #0f172a;
        }

        .editor-container {
            min-height: calc(100vh - 80px);
        }

        .canvas-wrapper {
            background-image: radial-gradient(#334155 1px, transparent 1px);
            background-size: 20px 20px;
        }

        #imageCanvas {
            max-width: 100%;
            max-height: 70vh;
            object-fit: contain;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        .filter-card {
            transition: all 0.2s;
            cursor: pointer;
        }

        .filter-card:hover {
            transform: translateY(-2px);
            background: #1e293b;
        }

        .active-filter {
            border-color: #38bdf8;
            background: #1e293b;
        }

        /* Hide scrollbar but keep functionality */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>
<body class="overflow-x-hidden">

    <!-- Header -->
    <header class="h-16 border-b border-slate-800 flex items-center justify-between px-6 bg-slate-900/50 backdrop-blur-md sticky top-0 z-50">
        <div class="flex items-center gap-2">
            <div class="bg-sky-500 p-1.5 rounded-lg">
                <i class="fas fa-wand-magic-sparkles text-white"></i>
            </div>
            <h1 class="text-xl font-bold tracking-tight">PixelPerfect</h1>
        </div>
        
        <div class="flex items-center gap-3">
            <button onclick="document.getElementById('fileInput').click()" class="bg-slate-800 hover:bg-slate-700 px-4 py-2 rounded-full text-sm font-medium transition-colors">
                <i class="fas fa-upload mr-2"></i> Upload
            </button>
            <button id="downloadBtn" class="bg-sky-500 hover:bg-sky-400 px-4 py-2 rounded-full text-sm font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                <i class="fas fa-download mr-2"></i> Save
            </button>
        </div>
    </header>

    <main class="flex flex-col lg:flex-row editor-container">
        <!-- Sidebar Controls -->
        <aside class="w-full lg:w-80 bg-slate-900 border-r border-slate-800 overflow-y-auto no-scrollbar p-6 space-y-8">
            
            <!-- Adjustments Section -->
            <section>
                <h2 class="text-xs font-semibold text-slate-500 uppercase tracking-widest mb-6 flex items-center">
                    <i class="fas fa-sliders-h mr-2"></i> Adjustments
                </h2>
                
                <div class="space-y-6">
                    <div class="control-group">
                        <div class="flex justify-between mb-2">
                            <label class="text-sm text-slate-300">Brightness</label>
                            <span id="brightnessVal" class="text-xs text-sky-400 font-mono">100%</span>
                        </div>
                        <input type="range" id="brightness" min="0" max="200" value="100" class="slider-custom">
                    </div>

                    <div class="control-group">
                        <div class="flex justify-between mb-2">
                            <label class="text-sm text-slate-300">Contrast</label>
                            <span id="contrastVal" class="text-xs text-sky-400 font-mono">100%</span>
                        </div>
                        <input type="range" id="contrast" min="0" max="200" value="100" class="slider-custom">
                    </div>

                    <div class="control-group">
                        <div class="flex justify-between mb-2">
                            <label class="text-sm text-slate-300">Saturation</label>
                            <span id="saturationVal" class="text-xs text-sky-400 font-mono">100%</span>
                        </div>
                        <input type="range" id="saturation" min="0" max="200" value="100" class="slider-custom">
                    </div>

                    <div class="control-group">
                        <div class="flex justify-between mb-2">
                            <label class="text-sm text-slate-300">Grayscale</label>
                            <span id="grayscaleVal" class="text-xs text-sky-400 font-mono">0%</span>
                        </div>
                        <input type="range" id="grayscale" min="0" max="100" value="0" class="slider-custom">
                    </div>

                    <div class="control-group">
                        <div class="flex justify-between mb-2">
                            <label class="text-sm text-slate-300">Sepia</label>
                            <span id="sepiaVal" class="text-xs text-sky-400 font-mono">0%</span>
                        </div>
                        <input type="range" id="sepia" min="0" max="100" value="0" class="slider-custom">
                    </div>

                    <div class="control-group">
                        <div class="flex justify-between mb-2">
                            <label class="text-sm text-slate-300">Blur</label>
                            <span id="blurVal" class="text-xs text-sky-400 font-mono">0px</span>
                        </div>
                        <input type="range" id="blur" min="0" max="20" value="0" class="slider-custom">
                    </div>

                    <div class="control-group">
                        <div class="flex justify-between mb-2">
                            <label class="text-sm text-slate-300">Hue Rotate</label>
                            <span id="hueVal" class="text-xs text-sky-400 font-mono">0°</span>
                        </div>
                        <input type="range" id="hue" min="0" max="360" value="0" class="slider-custom">
                    </div>
                </div>

                <button id="resetBtn" class="w-full mt-8 py-2 text-sm font-medium text-slate-400 hover:text-white border border-slate-700 hover:border-slate-500 rounded-lg transition-all">
                    Reset All
                </button>
            </section>

            <!-- Filters Quick Actions -->
            <section class="pb-6">
                <h2 class="text-xs font-semibold text-slate-500 uppercase tracking-widest mb-4 flex items-center">
                    <i class="fas fa-magic mr-2"></i> Presets
                </h2>
                <div class="grid grid-cols-2 gap-2">
                    <div onclick="applyPreset('none')" class="filter-card p-3 border border-slate-800 rounded-lg text-center text-xs">None</div>
                    <div onclick="applyPreset('bw')" class="filter-card p-3 border border-slate-800 rounded-lg text-center text-xs">B&W</div>
                    <div onclick="applyPreset('vintage')" class="filter-card p-3 border border-slate-800 rounded-lg text-center text-xs">Vintage</div>
                    <div onclick="applyPreset('vibrant')" class="filter-card p-3 border border-slate-800 rounded-lg text-center text-xs">Vibrant</div>
                    <div onclick="applyPreset('dramatic')" class="filter-card p-3 border border-slate-800 rounded-lg text-center text-xs">Dramatic</div>
                    <div onclick="applyPreset('cool')" class="filter-card p-3 border border-slate-800 rounded-lg text-center text-xs">Cool</div>
                </div>
            </section>
        </aside>

        <!-- Canvas Area -->
        <section class="flex-1 canvas-wrapper flex items-center justify-center p-4 lg:p-12 relative overflow-hidden">
            <div id="dropZone" class="absolute inset-0 z-0 flex flex-col items-center justify-center text-slate-600 transition-opacity">
                <i class="fas fa-images text-6xl mb-4 opacity-20"></i>
                <p class="text-lg opacity-40">Drag & drop an image or click upload</p>
            </div>
            
            <canvas id="imageCanvas" class="hidden z-10 rounded-lg"></canvas>
            
            <input type="file" id="fileInput" accept="image/*" class="hidden">
        </section>
    </main>

    <script>
        const fileInput = document.getElementById('fileInput');
        const canvas = document.getElementById('imageCanvas');
        const ctx = canvas.getContext('2d');
        const dropZone = document.getElementById('dropZone');
        const downloadBtn = document.getElementById('downloadBtn');
        const resetBtn = document.getElementById('resetBtn');

        // Filter Inputs
        const filters = {
            brightness: document.getElementById('brightness'),
            contrast: document.getElementById('contrast'),
            saturation: document.getElementById('saturation'),
            grayscale: document.getElementById('grayscale'),
            sepia: document.getElementById('sepia'),
            blur: document.getElementById('blur'),
            hue: document.getElementById('hue')
        };

        let originalImage = null;

        // Initialize empty state
        downloadBtn.disabled = true;

        // File Selection Logic
        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) loadImage(file);
        });

        function loadImage(file) {
            const reader = new FileReader();
            reader.onload = (event) => {
                const img = new Image();
                img.onload = () => {
                    originalImage = img;
                    setupCanvas();
                    resetFilters();
                    applyFilters();
                    
                    // UI Transitions
                    canvas.classList.remove('hidden');
                    dropZone.style.opacity = '0';
                    downloadBtn.disabled = false;
                };
                img.src = event.target.result;
            };
            reader.readAsDataURL(file);
        }

        function setupCanvas() {
            // Set canvas size to match image aspect ratio
            const maxWidth = window.innerWidth * 0.8;
            const maxHeight = window.innerHeight * 0.7;
            let width = originalImage.width;
            let height = originalImage.height;

            // Maintain aspect ratio
            if (width > maxWidth) {
                height *= (maxWidth / width);
                width = maxWidth;
            }
            if (height > maxHeight) {
                width *= (maxHeight / height);
                height = maxHeight;
            }

            canvas.width = originalImage.width; // Keep high res for internal storage
            canvas.height = originalImage.height;
            
            // Visual style handled by CSS max-width/height
        }

        function applyFilters() {
            if (!originalImage) return;

            const b = filters.brightness.value;
            const c = filters.contrast.value;
            const s = filters.saturation.value;
            const g = filters.grayscale.value;
            const sp = filters.sepia.value;
            const bl = filters.blur.value;
            const h = filters.hue.value;

            // Update Labels
            document.getElementById('brightnessVal').innerText = b + '%';
            document.getElementById('contrastVal').innerText = c + '%';
            document.getElementById('saturationVal').innerText = s + '%';
            document.getElementById('grayscaleVal').innerText = g + '%';
            document.getElementById('sepiaVal').innerText = sp + '%';
            document.getElementById('blurVal').innerText = bl + 'px';
            document.getElementById('hueVal').innerText = h + '°';

            // Draw and Apply Filter
            ctx.filter = `
                brightness(${b}%) 
                contrast(${c}%) 
                saturate(${s}%) 
                grayscale(${g}%) 
                sepia(${sp}%) 
                blur(${bl}px) 
                hue-rotate(${h}deg)
            `;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(originalImage, 0, 0, canvas.width, canvas.height);
        }

        // Add Listeners to all sliders
        Object.values(filters).forEach(slider => {
            slider.addEventListener('input', applyFilters);
        });

        function resetFilters() {
            filters.brightness.value = 100;
            filters.contrast.value = 100;
            filters.saturation.value = 100;
            filters.grayscale.value = 0;
            filters.sepia.value = 0;
            filters.blur.value = 0;
            filters.hue.value = 0;
            applyFilters();
        }

        resetBtn.addEventListener('click', resetFilters);

        function applyPreset(type) {
            if (!originalImage) return;
            resetFilters();

            switch(type) {
                case 'bw':
                    filters.grayscale.value = 100;
                    filters.contrast.value = 120;
                    break;
                case 'vintage':
                    filters.sepia.value = 50;
                    filters.brightness.value = 90;
                    filters.contrast.value = 110;
                    break;
                case 'vibrant':
                    filters.saturation.value = 150;
                    filters.contrast.value = 110;
                    break;
                case 'dramatic':
                    filters.contrast.value = 150;
                    filters.brightness.value = 80;
                    filters.saturation.value = 80;
                    break;
                case 'cool':
                    filters.hue.value = 190;
                    filters.saturation.value = 110;
                    break;
            }
            applyFilters();
        }

        // Download logic using link hack for iframe environments
        downloadBtn.addEventListener('click', () => {
            if (!originalImage) return;
            const dataUrl = canvas.toDataURL('image/png');
            const link = document.createElement('a');
            link.download = 'pixelperfect-edit.png';
            link.href = dataUrl;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        });

        // Drag and Drop Logic
        const zone = document.body;
        zone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('bg-sky-500/5');
        });
        zone.addEventListener('dragleave', () => {
            dropZone.classList.remove('bg-sky-500/5');
        });
        zone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('bg-sky-500/5');
            const file = e.dataTransfer.files[0];
            if (file && file.type.startsWith('image/')) {
                loadImage(file);
            }
        });

    </script>
</body>
</html>

